@model ShoeStore.Models.User
@{
    var nextRank = ViewBag.NextRank as MemberRank;
}

<div class="container py-5">
    <div class="row">
        <!-- Thông tin cá nhân -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">Thông tin cá nhân</h4>
                </div>
                <div class="card-body">
                    <div class="profile-info">
                        <div class="row mb-3">
                            <div class="col-md-4"><strong>Username:</strong></div>
                            <div class="col-md-8">@Model.Username</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4"><strong>Họ tên:</strong></div>
                            <div class="col-md-8">@Model.FullName</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4"><strong>Email:</strong></div>
                            <div class="col-md-8">@Model.Email</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4"><strong>Số điện thoại:</strong></div>
                            <div class="col-md-8">@Model.Phone</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4"><strong>Ngày đăng ký:</strong></div>
                            <div class="col-md-8">@Model.RegisterDate.ToString("dd/MM/yyyy")</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Thông tin rank -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">Hạng thành viên</h4>
                </div>
                <div class="card-body">
                    <div class="member-rank text-center">
                        @if (Model.MemberRank != null)
                        {
                            <div class="rank-badge mb-3">
                                @if (!string.IsNullOrEmpty(Model.MemberRank.BadgeImage))
                                {
                                    <img src="@Model.MemberRank.BadgeImage" alt="@Model.MemberRank.RankName" class="img-fluid" style="max-width: 100px;">
                                }
                                else
                                {
                                    <div class="rank-icon @Model.MemberRank.RankName.ToLower()">
                                        <i class="fas fa-award"></i>
                                    </div>
                                }
                            </div>
                            <h3 class="rank-name mb-2">@Model.MemberRank.RankName</h3>
                            <p class="rank-description mb-3">@Model.MemberRank.Description</p>
                            <div class="discount-info alert alert-success">
                                Giảm giá @Model.MemberRank.DiscountPercent% mọi đơn hàng
                            </div>

                            @if (nextRank != null)
                            {
                                decimal remainingAmount = nextRank.MinimumSpent - Model.TotalSpent;
                                decimal progressPercent = (Model.TotalSpent / nextRank.MinimumSpent) * 100;

                                <div class="next-rank-progress mt-4">
                                    <p>Còn @remainingAmount.ToString("N0")đ để lên hạng @nextRank.RankName</p>
                                    <div class="progress">
                                        <div class="progress-bar" role="progressbar" 
                                             style="width: @progressPercent%"
                                             aria-valuenow="@progressPercent" 
                                             aria-valuemin="0" 
                                             aria-valuemax="100">
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <p>Bạn chưa có hạng thành viên</p>
                        }

                        <div class="total-spent mt-4">
                            <h5>Tổng chi tiêu</h5>
                            <p class="h3 text-primary">@Model.TotalSpent.ToString("N0")đ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .rank-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
    }

    .rank-icon.bronze { color: #cd7f32; }
    .rank-icon.silver { color: #c0c0c0; }
    .rank-icon.gold { color: #ffd700; }
    .rank-icon.platinum { color: #e5e4e2; }

    .progress {
        height: 10px;
        border-radius: 5px;
        background-color: #e9ecef;
    }

    .progress-bar {
        background-color: #007bff;
        border-radius: 5px;
    }

    .rank-name {
        font-weight: 600;
        color: #333;
    }

    .rank-description {
        color: #666;
    }

    .discount-info {
        font-weight: 500;
    }

    .total-spent {
        border-top: 1px solid #eee;
        padding-top: 1rem;
    }
</style>