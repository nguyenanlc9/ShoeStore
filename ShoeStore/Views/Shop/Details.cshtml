<div class="site-section">
    <div class="container">
        <!-- Phần 1: Thông tin cơ bản và form -->
        <div class="row mb-5">
            <div class="col-md-6">
                <img src="@Model.ImagePath" alt="@Model.Name" class="img-fluid">
            </div>
            <div class="col-md-6">
                <h2 class="text-black">@Model.Name</h2>
                <div class="mb-3">
                    <strong class="text-primary h4">
                        @if (Model.DiscountPrice > 0)
                        {
                            <del class="text-muted">@Model.Price.ToString("N0") đ</del>
                            <span>@Model.DiscountPrice.ToString("N0") đ</span>
                        }
                        else
                        {
                            <span>@Model.Price.ToString("N0") đ</span>
                        }
                    </strong>
                </div>

                <div class="mb-4">
                    <p class="mb-2">
                        <strong>Thương hiệu:</strong> @Model.Brands?.Name
                    </p>
                    <p class="mb-2">
                        <strong>Danh mục:</strong> @Model.Categories?.Name
                    </p>
                    <p class="mb-2">
                        <strong>Đã bán:</strong> @Model.SoldQuantity sản phẩm
                    </p>
                    <div class="mb-2">
                        <strong>Đánh giá:</strong>
                        @for (int i = 1; i <= 5; i++)
                        {
                            if (i <= Model.Rating)
                            {
                                <i class="fas fa-star text-warning"></i>
                            }
                            else
                            {
                                <i class="far fa-star text-warning"></i>
                            }
                        }
                        <span>(@Model.ReviewCount đánh giá)</span>
                    </div>
                </div>

                <form asp-controller="Cart" asp-action="AddToCart" method="post">
                    <input type="hidden" name="productId" value="@Model.ProductId" />
                    
                    <div class="mb-4">
                        <h5>Chọn size:</h5>
                        <div class="size-options">
                            @{
                                var availableStocks = new List<ProductSizeStock>();
                                foreach (var stock in Model.ProductSizeStocks)
                                {
                                    if (stock.StockQuantity > 0)
                                    {
                                        availableStocks.Add(stock);
                                    }
                                }
                            }
                            @foreach (var stock in availableStocks)
                            {
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="sizeId" 
                                           id="size_@stock.SizeID" value="@stock.SizeID" required>
                                    <label class="form-check-label" for="size_@stock.SizeID">
                                        @stock.Size.SizeID
                                    </label>
                                </div>
                            }
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="input-group mb-3" style="max-width: 200px;">
                            <div class="input-group-prepend">
                                <button class="btn btn-outline-primary" type="button" onclick="decreaseQuantity()">−</button>
                            </div>
                            <input type="number" class="form-control text-center" id="quantity" name="quantity" 
                                   value="1" min="1" max="10">
                            <div class="input-group-append">
                                <button class="btn btn-outline-primary" type="button" onclick="increaseQuantity()">+</button>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="buy-now btn btn-sm btn-primary">Thêm vào giỏ hàng</button>
                </form>
            </div>
        </div>

        <!-- Phần 2: Thông tin sản phẩm -->
        <div class="row mb-5">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4>Thông tin sản phẩm</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Thương hiệu:</strong> @Model.Brands?.Name</p>
                                <p><strong>Danh mục:</strong> @Model.Categories?.Name</p>
                                <p><strong>Mã sản phẩm:</strong> #@Model.ProductId</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Tình trạng:</strong> @(Model.Status == ProductStatus.Available ? "Còn hàng" : "Hết hàng")</p>
                                <p><strong>Đã bán:</strong> @Model.SoldQuantity sản phẩm</p>
                                <p><strong>Đánh giá:</strong> @Model.Rating/5 (@Model.ReviewCount đánh giá)</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phần 3: Mô tả sản phẩm -->
        <div class="row mb-5">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4>Mô tả sản phẩm</h4>
                    </div>
                    <div class="card-body product-description">
                        @if (!string.IsNullOrEmpty(Model.Description))
                        {
                            @Html.Raw(Model.Description)
                        }
                        else
                        {
                            <p>Chưa có mô tả cho sản phẩm này</p>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Phần 4: Đánh giá sản phẩm -->
        @if (Model.Reviews?.Any() == true)
        {
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h4>Đánh giá từ khách hàng</h4>
                            <div>
                                <span class="h5">@Model.Rating/5</span>
                                @for (int i = 1; i <= 5; i++)
                                {
                                    if (i <= Model.Rating)
                                    {
                                        <i class="fas fa-star text-warning"></i>
                                    }
                                    else
                                    {
                                        <i class="far fa-star text-warning"></i>
                                    }
                                }
                                <span>(@Model.ReviewCount đánh giá)</span>
                            </div>
                        </div>
                        <div class="card-body">
                            @foreach (var review in Model.Reviews)
                            {
                                <div class="review-item mb-4 pb-4 border-bottom">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <strong>@review.User?.FullName</strong>
                                            <div class="text-muted small">
                                                @review.CreatedAt.ToString("dd/MM/yyyy HH:mm")
                                            </div>
                                        </div>
                                        <div>
                                            @for (int i = 1; i <= 5; i++)
                                            {
                                                if (i <= review.Rating)
                                                {
                                                    <i class="fas fa-star text-warning"></i>
                                                }
                                                else
                                                {
                                                    <i class="far fa-star text-warning"></i>
                                                }
                                            }
                                        </div>
                                    </div>
                                    <p class="mt-2 mb-0">@review.Comment</p>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        function increaseQuantity() {
            var input = document.getElementById('quantity');
            var value = parseInt(input.value, 10);
            if (value < 10) input.value = value + 1;
        }

        function decreaseQuantity() {
            var input = document.getElementById('quantity');
            var value = parseInt(input.value, 10);
            if (value > 1) input.value = value - 1;
        }
    </script>
} 